name: Sync Kubectl

on:
#  schedule:
#    - cron: '0 18 * * *'  # Daily at 2 AM UTC+8 (18:00 UTC)
  workflow_dispatch:

jobs:
  sync:
    uses: ./.github/workflows/sync-multi-template.yml
    with:
      config: |
        {
          "version_key": "kubernetes/kubectl",
          "source_repo": "kubernetes/kubernetes",
          "sync_type": "release",
          "version_transform": "__import__('urllib.request').request.build_opener(__import__('urllib.request').request.HTTPRedirectHandler).open('https://dl.k8s.io/release/stable.txt').read().decode('utf-8').strip()",
          "components": [
            {
              "type": "dockerfile",
              "image_name": "kubectl",
              "dockerfile": "FROM alpine:latest\nRUN apk add --no-cache curl && \\\n    curl -LO \"https://dl.k8s.io/release/v{VERSION}/bin/linux/amd64/kubectl\" && \\\n    chmod +x kubectl && \\\n    mv kubectl /usr/local/bin/kubectl && \\\n    apk del curl\nENTRYPOINT [\"kubectl\"]"
            }
          ]
        }
    secrets: inherit

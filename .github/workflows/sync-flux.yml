name: Sync Flux (Command Extraction Example)

on:
  schedule:
    - cron: '0 18 */3 * *'  # Every 3 days at 2 AM UTC+8 (18:00 UTC)
  workflow_dispatch:

jobs:
  sync:
    uses: ./.github/workflows/sync-multi-template.yml
    with:
      config: |
        {
          "version_key": "fluxcd/flux2",
          "source_repo": "fluxcd/flux2",
          "sync_type": "release",
          "components": [
            {
              "type": "command",
              "command": "curl -s https://fluxcd.io/install.sh | bash -s -- /tmp && /tmp/flux install --components-extra='image-reflector-controller,image-automation-controller' --export | grep -E '^\\s+image:\\s+' | sed 's/.*image: *//'"
            }
          ]
        }
    secrets: inherit
